import dotenv from 'dotenv';
import {Configuration, OpenAIApi} from 'openai';

export async function 퀴즈생성() {
    dotenv.config();

    const configuration = new Configuration({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const openai = new OpenAIApi(configuration);

        // quiz 생성
        let response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

이런 문제를 만들어
문제만 제시해

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 유명한 음악가가 비행기 사고로 사막 한가운데에 불시착했다. 다행히도 그는 살아남았지만, 그가로 발견된 술병 하나와 비상식량 몇 가지를 가지고 생존했다. 신호 장비는 모두 망가져서 외부로 도와달라 요청할 길이 없었다.

음악가는 사막에서 홀로 몇 주를 버텼다. 그리고 어느 날, 마침내 구조대가 나타났다. 구조대는 그를 중, 그는 매우 충격적인 사실을 알게 되었다. 그 순간 음악가는 엄청난 충격을 받아 살아갈 의지를 잃고, 몇 시간 뒤 사라지고 말았다.

왜 그가 마침내 구조된 이후 절망하게 되었을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `유명한 화가가 깊은 정글 속을 탐험하던 중 길을 잃었다. 혼자서 살아남기 위해 그는 자연에서 구할의 물과 비상식량, 그리고 소형 라디오가 있었다. 그러나 라디오는 신호를 받지 못해 외부와의 소통이 불가능했다.

며칠 후, 화가는 라디오에서 희미하게나마 구조 신호를 받았다. 기뻤던 그는 구조대가 자신을 찾아오 그를 발견하고 구출했다.

하지만 구조된 후, 그는 급격히 우울해졌고, 급기야 치료도 거부한 채 홀로 남아 죽음을 맞이했다.

그가 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
            ],
        });

        let quiz = response.data.choices[0].message;
        console.log(quiz.content);


        response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

문제만 제시해
이런식의 소름돋는 이야기를 만들어줘

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 여자가 오랜만에 고향을 방문하여 어릴 적 자주 가던 놀이공원을 찾았다. 그곳에서 그녀는 오래된 회전목마에 탔다. 회전목마가 돌아가기 시작하자, 여자는 갑자기 얼굴이 창백해지더니 회전목마가 멈추기도 전에 뛰어내렸다.

                    여자는 급히 놀이공원을 빠져나와 인근 경찰서로 향했다. 경찰서에 도착한 여자는 충격에 휩싸인 채 경찰에게 말을 건넸다.
                    “회전목마 말이... 뭔가 이상해요. 반드시 조사해 주셔야 해요.”
                    
                    경찰은 놀이공원에 출동하여 회전목마를 조사한 후, 곧바로 놀이공원을 폐쇄하고 현장을 봉쇄했다.
                    
                    왜 그랬을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `한 여자가 고층 빌딩의 한 방에서 투신 자살을 결심했다. 그녀는 창문을 열고 뛰어내리기 전에 방 안을 천천히 둘러보며 미소를 지었다. 방 안에는 그녀가 사랑하는 물건들, 추억이 담긴 사진들, 그리고 그녀가 아끼던 모든 것이 있었다. 그녀는 왜 자살을 결심했으며, 왜 마지막 순간에 미소를 지었을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `그녀는 최근에 심각한 병을 진단받았다.
                    방 안의 물건들은 그녀가 과거에 누렸던 행복한 시간을 상기시켰다.
                    그녀는 자신이 떠난 후에도 이곳이 남아 있을 것을 알고 안심했다.`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `어느 날 한 여자가 집 안에 있는 모든 거울을 치우기 시작했다. 그녀는 화장대의 거울부터 욕실의 거울까지, 집 안의 모든 거울을 없애버렸다. 그 후로 그녀는 절대 거울을 보지 않았다. 그녀는 거울을 볼 때마다 무언가를 떠올리며 괴로워하는 것 같았다. 도대체 그녀는 왜 모든 거울을 치워버린 것일까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `그녀는 최근에 큰 사고를 당해 얼굴에 큰 흉터가 생겼다.
                    그녀는 거울을 볼 때마다 사고 당시의 기억이 떠올랐다.
                    그녀는 이전의 모습을 다시 볼 수 없다는 사실을 받아들이기 힘들었다.`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `한 남자가 매일 밤 침대에 들기 전에 침대 아래를 확인하는 습관이 있었다. 그는 침대 밑을 살피고 나서야 안심하고 잠이 들곤 했다. 어느 날 밤, 그는 매우 피곤해서 침대 아래를 확인하지 않고 바로 잠이 들었다. 다음 날 아침, 그의 아내는 흔적도 없이 사라져 있었다. 그는 왜 매일 밤 침대 아래를 확인했으며, 그의 아내는 왜 사라진 것일까?

몇 주 후, 작가는 점점 희망을 잃어갔으나, 갑자기 멀리서 구조대의 배가 나타났다. 그는 구조대에게 발견되어 무사히 구출되었다.

그런데 구조된 즉시, 작가는 깊은 절망감을 느낀 나머지 자신이 가진 물건을 하나하나 태워버린 후, 누구와도 대화하지 않고 혼자 떠났다. 얼마 지나지 않아 그의 시신이 발견되었다.

작가는 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `그 남자는 과거에 강도에게 공격당한 경험이 있었다.
                    그의 아내는 남자가 잠든 후에 외출하는 비밀스러운 습관이 있었다.
                    그 밤, 그의 아내는 누군가에게 납치되었다.
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `한 여자가 매일 아침 우체통을 열고 편지를 확인하는 습관이 있었다. 어느 날, 그녀는 우체통에서 편지를 꺼내 읽었고, 그 편지는 단순한 청구서에 불과했다. 하지만 그녀는 그 편지를 읽고 나서 갑자기 울음을 터뜨렸다. 편지의 내용은 특별할 것이 없었고, 그냥 일상적인 청구서였다. 그녀는 왜 그 편지를 보고 울음을 터뜨렸을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `그녀는 최근에 남편을 잃었다.
                    남편은 생전에 모든 청구서를 처리하는 역할을 맡았었다.
                    청구서의 발신인은 남편의 이름으로 되어 있었다.`
                },
                {
                    role: 'system', content: `${quiz}`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                }
            ],
        });

        let hint3 = response.data.choices[0].message;
        console.log(hint3.content);

        return {
            quiz: quiz.content,
            hintList: [...hint3.content.split("\n")]
        };

    } catch (error) {
        console.error('Error calling ChatGPT API:', error.response.data);
        return null;
    }
}

export async function 답변응답(quiz, question) {
    dotenv.config();

    const configuration = new Configuration({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const openai = new OpenAIApi(configuration);

        const response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다. 출제자는 예/아니오 로만 대답 가능하다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""
문제만 제시해

이런식의 소름돋는 이야기를 만들어줘
문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 남자는 매일 아침 일어나면 침대 옆 탁자 위에 놓인 낡은 시계를 확인하는 습관이 있었다. 어느 날 아침, 그는 시계를 확인한 후 갑자기 눈물을 흘리기 시작했다. 시계는 여전히 정상적으로 작동하고 있었다. 그는 왜 눈물을 흘렸을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `한 여자는 매일 저녁 같은 시간에 공원 벤치에 앉아 있었다. 어느 날 저녁, 그녀는 벤치에 앉아 있다가 갑자기 자리에서 일어나 급히 자리를 떠났다. 그녀가 벤치에 앉아 있었던 이유는 무엇이며, 왜 갑자기 떠났을까?
`
                },
                {
                    role: 'user', content: `화장실이 가고싶었어`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `밥먹으러 갔어`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `친구가 왔어`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `슬픈 기억 때문이었나`
                },
                {
                    role: 'system', content: `예 `
                },
                {
                    role: 'user', content: `죽은 가족 때문인가`
                },
                {
                    role: 'system', content: `예 `
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `${quiz}`
                },
                {
                    role: 'user', content: `${question}`
                }
            ],
        });
        return response.data.choices[0].message.content;
    } catch (error) {
        console.error('Error calling ChatGPT API:', error.response.data);
        return null;
    }
}

export async function 정답응답(quiz, answer) {
    dotenv.config();

    const configuration = new Configuration({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const openai = new OpenAIApi(configuration);

        const response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다. 출제자는 예/아니오 로만 대답 가능하다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

이런 문제를 만들어
문제만 제시해

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 유명한 음악가가 비행기 사고로 사막 한가운데에 불시착했다. 다행히도 그는 살아남았지만, 그가로 발견된 술병 하나와 비상식량 몇 가지를 가지고 생존했다. 신호 장비는 모두 망가져서 외부로 도와달라 요청할 길이 없었다.

음악가는 사막에서 홀로 몇 주를 버텼다. 그리고 어느 날, 마침내 구조대가 나타났다. 구조대는 그를 중, 그는 매우 충격적인 사실을 알게 되었다. 그 순간 음악가는 엄청난 충격을 받아 살아갈 의지를 잃고, 몇 시간 뒤 사라지고 말았다.

왜 그가 마침내 구조된 이후 절망하게 되었을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `유명한 화가가 깊은 정글 속을 탐험하던 중 길을 잃었다. 혼자서 살아남기 위해 그는 자연에서 구할의 물과 비상식량, 그리고 소형 라디오가 있었다. 그러나 라디오는 신호를 받지 못해 외부와의 소통이 불가능했다.

며칠 후, 화가는 라디오에서 희미하게나마 구조 신호를 받았다. 기뻤던 그는 구조대가 자신을 찾아오 그를 발견하고 구출했다.

하지만 구조된 후, 그는 급격히 우울해졌고, 급기야 치료도 거부한 채 홀로 남아 죽음을 맞이했다.

그가 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `구조 상황에서 문제가 있었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `치료에 돈이 많이 들었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `사실 꿈이었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `라디오의 배터리가 방전된 상태였나?`
                },
                {
                    role: 'system', content: `예, 화가가 절망에 빠져 죽음을 선택한 이유는 구조 신호를 받은 라디오의 배터리가 방전된 상태였기 때문입니다.

    그는 구조 신호를 받은 것이 단지 환상이나 희망적인 착각이었다는 사실을 알게 되었고, 실제로는 구조될 가능성이 없다는 현실을 깨닫게 되었습니다. 이는 그의 정신적 고통을 극대화시켜, 결국 그는 절망에 빠져 자발적으로 생을 마감하기로 결심하게 되었습니다.`
                },
                {
                    role: 'user', content: `정답 : 화가가 멍청이었나?`
                },
                {
                    role: 'system', content: `아니오, 화가가 절망에 빠져 죽음을 선택한 이유는 구조 신호를 받은 라디오의 배터리가 방전된 상태였기 때문입니다.

    그는 구조 신호를 받은 것이 단지 환상이나 희망적인 착각이었다는 사실을 알게 되었고, 실제로는 구조될 가능성이 없다는 현실을 깨닫게 되었습니다. 이는 그의 정신적 고통을 극대화시켜, 결국 그는 절망에 빠져 자발적으로 생을 마감하기로 결심하게 되었습니다.`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `${quiz}`
                },
                {
                    role: 'user', content: `정답 : ${answer}`
                },
            ],
        });
        return response.data.choices[0].message.content;
    } catch (error) {
        console.error('Error calling ChatGPT API:', error.response.data);
        return null;
    }
}