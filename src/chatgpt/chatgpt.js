import dotenv from 'dotenv';
import {Configuration, OpenAIApi} from 'openai';

export async function 퀴즈생성() {
    dotenv.config();

    const configuration = new Configuration({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const openai = new OpenAIApi(configuration);

        // quiz 생성
        let response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

이런 문제를 만들어
문제만 제시해

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 유명한 음악가가 비행기 사고로 사막 한가운데에 불시착했다. 다행히도 그는 살아남았지만, 그가로 발견된 술병 하나와 비상식량 몇 가지를 가지고 생존했다. 신호 장비는 모두 망가져서 외부로 도와달라 요청할 길이 없었다.

음악가는 사막에서 홀로 몇 주를 버텼다. 그리고 어느 날, 마침내 구조대가 나타났다. 구조대는 그를 중, 그는 매우 충격적인 사실을 알게 되었다. 그 순간 음악가는 엄청난 충격을 받아 살아갈 의지를 잃고, 몇 시간 뒤 사라지고 말았다.

왜 그가 마침내 구조된 이후 절망하게 되었을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `유명한 화가가 깊은 정글 속을 탐험하던 중 길을 잃었다. 혼자서 살아남기 위해 그는 자연에서 구할의 물과 비상식량, 그리고 소형 라디오가 있었다. 그러나 라디오는 신호를 받지 못해 외부와의 소통이 불가능했다.

며칠 후, 화가는 라디오에서 희미하게나마 구조 신호를 받았다. 기뻤던 그는 구조대가 자신을 찾아오 그를 발견하고 구출했다.

하지만 구조된 후, 그는 급격히 우울해졌고, 급기야 치료도 거부한 채 홀로 남아 죽음을 맞이했다.

그가 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
            ],
        });

        let quiz = response.data.choices[0].message;
        console.log(quiz.content);


        response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

이런 문제를 만들어
문제만 제시해

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 유명한 음악가가 비행기 사고로 사막 한가운데에 불시착했다. 다행히도 그는 살아남았지만, 그가로 발견된 술병 하나와 비상식량 몇 가지를 가지고 생존했다. 신호 장비는 모두 망가져서 외부로 도와달라 요청할 길이 없었다.

음악가는 사막에서 홀로 몇 주를 버텼다. 그리고 어느 날, 마침내 구조대가 나타났다. 구조대는 그를 중, 그는 매우 충격적인 사실을 알게 되었다. 그 순간 음악가는 엄청난 충격을 받아 살아갈 의지를 잃고, 몇 시간 뒤 사라지고 말았다.

왜 그가 마침내 구조된 이후 절망하게 되었을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `유명한 화가가 깊은 정글 속을 탐험하던 중 길을 잃었다. 혼자서 살아남기 위해 그는 자연에서 구할의 물과 비상식량, 그리고 소형 라디오가 있었다. 그러나 라디오는 신호를 받지 못해 외부와의 소통이 불가능했다.

며칠 후, 화가는 라디오에서 희미하게나마 구조 신호를 받았다. 기뻤던 그는 구조대가 자신을 찾아오 그를 발견하고 구출했다.

하지만 구조된 후, 그는 급격히 우울해졌고, 급기야 치료도 거부한 채 홀로 남아 죽음을 맞이했다.

그가 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `1. 화가는 구조되기 직전까지 그나마 신호를 잡을 수 있었던 라디오를 유일한 희망으로 여겼다.
        2. 구조대가 화가를 발견했을 때, 라디오에서 들리던 신호는 구조 신호가 아니라 일종의 방송이었다.
        3. 그 방송은 화가의 실종에 관한 이야기와 그를 찾기 위해 벌어지는 일들을 상세히 다루고 있었으나, 그 내용을 듣고 그는 자신이 사실상 모두에게 잊혀졌다는 것을 깨닫게 되었다.`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `한 유명 작가가 어떤 오지의 섬에서 조사 활동을 하던 중 착오로 인해 홀로 그곳에 남겨졌다. 그는 자신이 생존할 한 상황이었지만 그는 끈질기게 버텼다.

며칠 후, 마침내 구조대가 그를 찾아와 구조하였다. 그러나 작가는 구조된 후 이내 깊은 슬픔에 빠져들었고, 결국 며칠 뒤 정신적 충격으로 인해 생을 마감했다.

왜 작가는 구출된 후에도 극심한 절망감을 느끼고 스스로 생을 마감했을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `1. 화가는 정글에서 살아남기 위해 라디오는 그의 유일한 동반자이자 희망이었다.
                    2. 구조대는 화가를 발견했을 때, 라디오에서는 그의 실종 사건을 다룬 방송이 나오고 있었다.
                    3. 방송을 들은 화가는 자신이 사실상 세상 사람들에게 잊혀졌다는 사실에 충격을 받았다.`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `유명한 작가가 요트를 타고 항해를 하던 중 거대한 폭풍에 휘말려 외딴 무인도에 표류하게 되었다. 그가 가진 것이 없었고, 그는 무인도에서 혼자 생존해야 했다.

몇 주 후, 작가는 점점 희망을 잃어갔으나, 갑자기 멀리서 구조대의 배가 나타났다. 그는 구조대에게 발견되어 무사히 구출되었다.

그런데 구조된 즉시, 작가는 깊은 절망감을 느낀 나머지 자신이 가진 물건을 하나하나 태워버린 후, 누구와도 대화하지 않고 혼자 떠났다. 얼마 지나지 않아 그의 시신이 발견되었다.

작가는 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `1. 탐험가는 수 주 동안 라디오를 통해 들리던 신호를 유일한 희망으로 삼고 있었다.
2. 구조대가 그를 찾았을 때, 라디오에서 들리던 신호는 실제로 구조 신호가 아니었다.
3. 그 신호는 사실 탐험가의 실종 사건과 관련된 방송이었고, 그 탐험가는 자신이 사실상 이미 세상에서 잊혀졌음을 깨달았다.
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `한 유명한 탐험가가 하늘에서 날아온 불의 구름을 목격한 후 깊은 우주를 탐사하기 위한 임무를 맡았다. 그는 대규공지능 동료와 제한된 자원만이 주어졌다.

여러 행성을 탐사한 끝에, 그는 결국 지구에 귀환한다. 지구에 도착했을 때, 그는 전혀 예상치 못한 충격적인 발견통을 차단하고 스스로 목숨을 끊었다.

왜 그가 지구에 귀환한 이후 절망감을 느낀 것일까?
`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                },
                {
                    role: 'system', content: `1. 작가는 무인도에서 생존하는 동안, 오래된 신문 조각들을 찾아 읽으며 희망을 버텼다.
2. 구조될 당시, 구조대는 그의 거처에서 단 하나의 신문 조각이 있는 것을 발견했다.
3. 그 신문 조각에는 자신이 이미 실종 상태로 오랜 기간 동안 판명되었고, 가족과 친구들이 자신을 포기했다는 내용이 적혀 있었다.`
                },
                {
                    role: 'system', content: `${quiz}`
                },
                {
                    role: 'user', content: `세가지 힌트를 각 각 한문장씩 줘`
                }
            ],
        });

        let hint3 = response.data.choices[0].message;
        console.log(hint3.content);

        return {
            quiz: quiz.content,
            hintList: [...hint3.content.split("\n")]
        };

    } catch (error) {
        console.error('Error calling ChatGPT API:', error.response.data);
        return null;
    }
}

export async function 답변응답(quiz, question) {
    dotenv.config();

    const configuration = new Configuration({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const openai = new OpenAIApi(configuration);

        const response = await openai.createChatCompletion({
            model: 'gpt-4o',
            messages: [
                {
                    role: 'user', content: `게임의 방법은 아래와 같다.

1. 출제자가 (이야기 형식의) 수수께끼를 만들어 출제한다.
2. 참가자들은 출제자에게 스무고개 형식의 질문[2]을 하고, 출제자는 그에 대한 대답을 한다. 출제자는 예/아니오 로만 대답 가능하다.
3. 정보를 통해 참가자들은 이야기의 전말을 추리한다.
4. 적당한 때가 되면 출제자는 정답을 공개한다.
예와 아니요 질문으로 여럿이 참가하는 놀이는 특히 인터넷 게시판 등에서 여러 사람이 참가하며 행해질 때가 많다.

문제가 허를 찌르는 재미있는 것일수록, 또 질문자들의 추리력이 높을수록 좋은 게임을 할 수 있으며, 모두가 즐겁게 된다. 사실 문제 내면서 대답하는 사람이 제일 재미있고 제일 힘들다. 출제자의 아이디어와 대답하는 요령, 질문자들의 추리력과 질문하는 요령, 또 전체 참가자의 매너가 상당히 중요한 게임이다.

문제 예시)
"""
한 남자가, 어느 바닷가 레스토랑에서 바다거북 수프를 주문했으며 그 남자는 바다거북 수프를 한 수저 먹고는 주방장을 불렀다.
“죄송합니다. 이거 정말로 바다거북 수프인가요?”
“네, 틀림없는 바다거북 수프 맞습니다.”
남자는 계산을 마친 뒤 집에 돌아가서 자살했다.
왜 그랬을까?
"""

문제가 출제되면, 참가하는 여러 사람들은 출제자가 예, 아니요로 대답할 수 있는 질문을 하게 된다.
바닷가 레스토랑인 게 중요합니까?
남자는 빚을 지고 있습니까?
남자가 자살한 것은 수프를 먹은 것이 원인입니까?
주방장은 남자입니까?

이러한 질문에 출제자는 하나하나 대답해 간다. 약간의 힌트를 줘서 푸는 사람들을 정답으로 유도할 수도 있다. 이 놀이는 답을 못 맞히면 출제자가 이기는 그런 놀이가 아니라 어떻게 재미있게 답을 추측해 가느냐, 얼마나 날카로운 질문을 하느냐가 중요하기 때문에 즐거운 플레이를 위해서는 출제자의 적절한 대답 스킬이 요구된다.
바닷가 레스토랑인 게 중요합니까? → 조금은 관계있습니다.
남자는 빚을 지고 있습니까? → 아니요.
남자가 자살한 것은 수프를 먹은 것이 원인입니까? → 네! 아주 중요합니다!
주방장은 남자입니까? → 상관없습니다.

출제자와의 문답으로 얻는 정보들을 가지고 참가자들은 서로 토론하기도 하고 독자적으로 추리하기도 하면서 이야기의 미스터리를 풀어나간다.
왜 수프 좀 먹었다고 자살하지?
남자의 과거에 무슨 일이 있었던 것 같은데?
바다거북 수프는 맛있나?
요리사가 악당인가?
바다거북이라는 재료가 중요한가?

이러한 과정에서 최종적으로는 누군가가 정답, 또는 정답과 아주 가까운 질문을 하게 된다. 때가 무르익었다고 생각되면 출제자는 답을 맞힌 사람과 다른 참가자들을 칭찬하고 미리 준비해 둔 해답문을 공개한다.

### 답

"""
남자는 배를 타고 있었는데 남자가 탄 배가 조난되었다. 몇 명의 다른 사람들과 함께 구명보트를 타서 죽음은 면했지만, 작은 섬에 표류하는 처지가 되었다.
식재료가 떨어진 일행은 체력이 떨어지는 사람부터 죽어가기 시작했다. 결국, 살아남은 사람들은 살기 위하여 시체의 살을 먹기 시작했지만, 단 한 사람은 이 행위를 강력하게 거부했다. 당연히 그 남자는 서서히 죽어가게 되었다.
이 꼴을 가만히 둘 수 없었던 다른 사람 중 하나가 “이건 바다거북 수프야”라고 거짓말을 한 다음 남자에게 수프를 먹여서, 구조될 때까지 살아남을 수 있었다.

그 뒤 레스토랑에서 명백하게 맛이 전혀 다른 이 진짜 바다거북 수프를 직면하게 된 남자는 자신이 인육을 먹었다는 진실을 알게 된 뒤 죄책감에 목숨을 끊었다.
"""

이런 문제를 만들어
문제만 제시해

문제를 설명할때 장황하게 설명해줘`
                },
                {
                    role: 'system', content: `한 유명한 음악가가 비행기 사고로 사막 한가운데에 불시착했다. 다행히도 그는 살아남았지만, 그가로 발견된 술병 하나와 비상식량 몇 가지를 가지고 생존했다. 신호 장비는 모두 망가져서 외부로 도와달라 요청할 길이 없었다.

음악가는 사막에서 홀로 몇 주를 버텼다. 그리고 어느 날, 마침내 구조대가 나타났다. 구조대는 그를 중, 그는 매우 충격적인 사실을 알게 되었다. 그 순간 음악가는 엄청난 충격을 받아 살아갈 의지를 잃고, 몇 시간 뒤 사라지고 말았다.

왜 그가 마침내 구조된 이후 절망하게 되었을까?
`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: "system", content: `유명한 화가가 깊은 정글 속을 탐험하던 중 길을 잃었다. 혼자서 살아남기 위해 그는 자연에서 구할의 물과 비상식량, 그리고 소형 라디오가 있었다. 그러나 라디오는 신호를 받지 못해 외부와의 소통이 불가능했다.

며칠 후, 화가는 라디오에서 희미하게나마 구조 신호를 받았다. 기뻤던 그는 구조대가 자신을 찾아오 그를 발견하고 구출했다.

하지만 구조된 후, 그는 급격히 우울해졌고, 급기야 치료도 거부한 채 홀로 남아 죽음을 맞이했다.

그가 왜 구조된 후 절망에 빠져 죽음을 선택했을까?
`
                },
                {
                    role: 'user', content: `구조 상황에서 문제가 있었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `치료에 돈이 많이 들었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `사실 꿈이었어?`
                },
                {
                    role: 'system', content: `아니오`
                },
                {
                    role: 'user', content: `문제를 다시 만들어줘`
                },
                {
                    role: 'system', content: `${quiz}`
                },
                {
                    role: 'user', content: `${question}`
                }
            ],
        });
        return response.data.choices[0].message.content;
    } catch (error) {
        console.error('Error calling ChatGPT API:', error.response.data);
        return null;
    }
}